function playNext(){pausePlayButton=nextAudio.parent().find(".icon-play")[0],pausePlayIcon=$(pausePlayButton).children().children(),setTimeout(function(){playAudio()},10)}function setStoryDuration(){$audio.each(function(){var a=Math.floor(this.duration/60),e=Math.floor(this.duration-60*a);e=10>e?"0"+e:e;var i=a+":"+e;$(this).closest(".story").find(".audio-duration").html(i)})}function playAudio(){console.log(pausePlayButton),console.log(pausePlayIcon),audioFileWrapper=$(pausePlayButton).nextAll("audio"),audioFile=audioFileWrapper[0],chapterNumber=audioFileWrapper.closest(".single-chapter").attr("data-index"),chapterTitle=audioFileWrapper.closest(".single-chapter").find("h2").text(),storyTitle=audioFileWrapper.closest(".story").find("h4").text(),nextAudio=audioFileWrapper.closest(".story").next().find("audio"),1===audioPlaying&&(console.log("another songs playing so pause it and clear the timer"),clearInterval(songTimer),$("audio.playing")[0].pause(),$("audio.playing")[0].currentTime=0,$(".icon-play.playing").removeClass("playing"),$(".fa-pause").removeClass("fa-pause").addClass("fa-play"),$("audio.playing").removeClass("playing"),$scrubBarPlayPause.removeClass("playing")),$(".scrub-hidden").length&&$(".footer").removeClass(".scrub-hidden").addClass("scrub-visible"),$("#scrub-wrapper .chapter-number").html(chapterNumber),$("#scrub-wrapper .chapter-title").html(chapterTitle),$("#scrub-wrapper .story").html(storyTitle),$scrubBarPlayPause.find("i").removeClass("fa-play").addClass("fa-pause"),audioFile.play(),$(pausePlayButton).addClass("playing"),$scrubBarPlayPause.addClass("playing"),pausePlayIcon.removeClass("fa-play").addClass("fa-pause"),audioFileWrapper.addClass("playing"),audioPlaying=1,songTimer=setInterval(function(){updateTime()},100),trackAudioEnd(audioFileWrapper,audioFile),audioFile.addEventListener("progress",function(){var a=[];for(i=0;i<audioFile.buffered.length;i++)a.push([audioFile.buffered.end(i)]),loadBarWidth=100/audioFile.duration*a[i],$(".load-bar").css({width:loadBarWidth+"%"}),audioFile.currentTime>=a[i]?$(".fa-pause").removeClass("fa-pause").addClass("fa-refresh fa-spin"):$(".fa-refresh").length&&$(".fa-refresh").removeClass("fa-refresh fa-spin").addClass("fa-pause")},!1),console.log("playAudio")}function trackAudioEnd(){audioFile.addEventListener("ended",function(){pauseAudio(),nextAudio.length?setTimeout(function(){playNext()},0):$(".footer").removeClass("scrub-visible").addClass("scrub-hidden"),$("audio").each(function(){$(this).currentTime=0})})}function updateTime(){var a=audioFile.currentTime,e=Math.floor(a/60),i=Math.floor(a-60*e);i=10>i?"0"+i:i;var s=e+":"+i,l=audioFile.duration,r=l-a,o=Math.floor(r/60),n=Math.floor(r-60*o);n=10>n?"0"+n:n;var t=o+":"+n;isNaN(r)||isNaN(a)?($("#scrub-wrapper .current-time").html("0:00"),$("#scrub-wrapper .remaining-time").html("0:00")):($("#scrub-wrapper .current-time").html(s),$("#scrub-wrapper .remaining-time").html("-"+t));var u=100/l*a;$seekBar.slider("option","value",u)}function pauseAudio(){console.log(pausePlayButton),console.log(pausePlayIcon),audioFile.pause(),audioPlaying=0,$(pausePlayButton).removeClass("playing"),$scrubBarPlayPause.removeClass("playing"),pausePlayIcon.removeClass("fa-pause").addClass("fa-play"),$scrubBarPlayPause.find("i").removeClass("fa-pause").addClass("fa-play"),audioFileWrapper.removeClass("playing"),clearInterval(songTimer)}function stopAudio(a,e){audioPlaying=0}function reset(){winHeight=$win.height(),winWidth=$win.width(),$homeWrapper.css({height:winHeight}),$singleChapter.css({width:winWidth}),$draggableHandle.css({width:singleChapterLength*winWidth})}var $homeWrapper=$("#home"),$win=$(window),$body=$("body, html"),$singleChapter=$(".single-chapter"),$chaptersWrapper=$("#carousel"),$draggableHandle=$(".handle"),$audio=$("audio"),singleChapterLength=$singleChapter.length,dragged=0,audioPlaying=0,audioFile,audioFileWrapper,target,active,winHeight=$win.height(),winWidth=$win.width(),chapterTitle,storyTitle,winHeight,winWidth,pausePlayButton,pausePlayIcon,nextAudio,bigPausePlayButton,$scrubBarPlayPause=$("#scrub-wrapper").find(".icon-play"),$scrubBarPlayPauseIcon=$scrubBarPlayPause.find("i"),$individualSongPlayPause=$(".single-play .icon-play"),allStories=$(".story"),$scrubWrapperWidth=$("#scrub-wrapper .right").width(),$seekBar=$(".played"),loadBarWidth;reset(),$win.ready(function(){console.log("window-loaded"),$("#loader").fadeOut("slow"),$seekBar.slider()}),$body.addClass(Modernizr.touch?"touch":"no-touch"),$win.resize(function(){draggable.reflow(),reset()}),$(document).on("keydown",function(a){switch(a.which){case 32:0===audioPlaying&&"undefined"!=typeof audioFileWrapper?playAudio():1===audioPlaying&&(pauseAudio(),console.log("puase that shits"))}}),$seekBar.slider({step:.01,animate:"fast",slide:function(a,e){audioFile.currentTime=e.value*(audioFile.duration/100)}}),$("#scroll-placeholder").css({height:2*winHeight}),$win.on("scroll",function(){$win.scrollTop()>winHeight&&$("#main-wrapper").hasClass("fixed")?(console.log("unfix mainwrapper"),$("#main-wrapper").removeClass("fixed"),$("#scroll-placeholder").css({height:0})):$win.scrollTop()<winHeight&&!$("#main-wrapper").hasClass("fixed")&&(console.log("fix mainwrapper"),$("#main-wrapper").addClass("fixed"),$("#scroll-placeholder").css({height:2*winHeight}))}),$(".scroll-to-first").on("click",function(){$body.animate({scrollTop:winHeight+0},1e3,"easeOutQuint"),console.log("clicked")});var draggable=new Dragdealer("carousel",{steps:singleChapterLength,speed:.1,loose:!0,requestAnimationFrame:!0,callback:function(a,e){var i=parseInt(a*singleChapterLength);1===a&&(i-=1),dragged=1,console.log(a,i);var s=$(".single-chapter:eq("+i+")").attr("data-title");$.address.value(s),dragged=0}});$(document).on("click","ul#nav-list li",function(a){var e=$(this).index(),i=$(".single-chapter:eq("+e+")").attr("data-title");return dragged=0,$.address.value(i),console.log(e),!1}),$.address.change(function(a){var e=a.value.split("/"),i=e[1],s=$("[data-title = "+i+"]"),l=s.index();$(".single-chapter.active").removeClass("active"),$(".single-chapter:eq("+l+")").addClass("active"),$("ul#nav-list li a.active").removeClass("active"),$("ul#nav-list li a:eq("+l+")").addClass("active"),1!==dragged&&draggable.setStep(l+1,0),console.log("change")}),$individualSongPlayPause.on("click",function(){return pausePlayButton=this,pausePlayIcon=$(pausePlayButton).children().children(),pausePlayIcon.hasClass("fa-play")?playAudio():pausePlayIcon.hasClass("fa-pause")&&pauseAudio(),!1}),$scrubBarPlayPause.on("click",function(){return $scrubBarPlayPauseIcon.hasClass("fa-play")?playAudio():$scrubBarPlayPauseIcon.hasClass("fa-pause")&&pauseAudio(),!1});